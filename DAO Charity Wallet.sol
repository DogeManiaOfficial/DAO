//                                                                        .:.     .::...                                                          
//                                                                      .-:    .:----:.                                                          
//                                      .-=+++==-:.                    .-.    .----:              .:-=+++=-.                                     
//                                     -**#******#*+=-.               .:.   .:----.          .....-===+**#*#-                                    
//                                    :#**=:::::::-+*+:              .:.   .:---:.      .:::-----::-:::::-**#:                                   
//                                    *#*:.-======: .               .:. . .----:.    .::---::...     .-==.:*##.                                  
//                                   =#*-.====+==:.                 :.  ..----:    .:--::..            .-=.-*#=                                  
//                                  .*#+ -==+=-.                   :.    :---:.  .:--:.          ....:::.:- +##.                                 
//                                  :##-.===-.                    .:    :----. .:-:.        ..:::-------:::.:*%-                                 
//                                  =%*.:=:.                      .. . .----: .--.       ..:--------::..    .*%=                                 
//                                  :**.:.          ......        .    :-:-:.:-:       .::--::::-::.        .+#+                                 
//                                 ...-          .:=+****+++++=====----==-----:......:-========-:.    .      -%*                                 
//                                  .         .:=************************************************+=-.         #*                                 
//                                          :=*******************************************************+:.    . =*                                 
//                                        :+************************************************************-.    .-                                 
//                                       -****************************************************************-                                      
//                                      .*****************************************************************#-                                     
//                                      -*****************#@@@@%********************#%@@@#******************                                     
//                                      =******************@@@@@@#****************#@@@@@@#******************-                                    
//                                      +*******************#%@@@#****************#@@@%#*********************+:                                  
//                                     -******************:.  :+**********************=. ..-******************+                                  
//                                  :=+******************:  .*- +********************- ++   -******************:                                 
//                                  +********************.. :@% .*******************+ :@#.. :******************+.                                
//                                 *@%#******************-   .. .*******************+  ..   +****************#%@*                                
//                                -@@@@@#*****************-.   .+**+=-:-=====:-=+****-.   .+***************#@@@@@-                               
//                                #@@@@@@%******************==+#%%=    -=++=-    =%###*==+****************%@@@@@@%                               
//                               :@@@@@@@@@#***************#%@@@@@=  ..      ..  =@@@@@%#***************#@@@@@@@@@:                              
//                               -@@@@@@@@@@%##********##%@@@@@@@@@+:    ..    .+@@@@@@@@@%##********##%@@@@@@@@@@-                              
//                               -@@@@@@@@@@@@@@@@@@@@@@@%-@@@@@@@@@@#+=.  .=+#@@@@@@@@@@-%@@@@@@@@@@@@@@@@@@@@@@@-                              
//                               :@@@@@@@@@@@@@@@@@@@@@@@@-.*@@@@@@@@@%+.  .+%@@@@@@@@@#.-@@@@@@@@@@@@@@@@@@@@@@@@:                              
//                                *@@@@@@@@@@@@@@@@@@@@@@@@+::-++**+=:        :=+***+=::+@@@@@@@@@@@@@@@@@@@@@@@@#                               
//                                :@@@@@@@@@@@@@@@@@@@@@@@@@@=                        =@@@@@@@@@@@@@@@@@@@@@@@@@@:                               
//                                 -@@@@@@@@@@@@@@@@@@@@@@@@@@: ..   ..::::::..   .. :%@@@@@@@@@@@@@@@@@@@@@@@@@=                                
//                                  -%@@@@@@@@@@@@@@@@@@@@@@@@#. ..:=++++++++++=:.   #@@@@@@@@@@@@@@@@@@@@@@@@@-                                 
//                                   .*@@@@@@@@@@@@@@@@@@@@@@@@#. =++++++++++++++=  *@@@@@@@@@@@@@@@@@@@@@@@@#:                                  
//                                     -#@@@@@@@@@@@@@@@@@@@@@@@%: :=+++++++++++- :#@@@@@@@@@@@@@@@@@@@@@@@#-                                    
//                                       -*%@@@@@@@@@@@@@@@@@@@@@@+. :-==++==-:..+@@@@@@@@@@@@@@@@@@@@@@%*-                                      
//                                         .=*%@@@@@@@@@@@@@@@@@@@@@*=:......:=*@@@@@@@@@@@@@@@@@@@@@%*=.                                        
//                                            .-+#%@@@@@@@@@@@@@@@@@@@@@%%%%@@@@@@@@@@@@@@@@@@@@@%#+-.                                           
//                                                .:=+#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#+=-.                                               
//                                                    ..::-=+**##%%%@@@@@@@@@@@@%%%%#**+=-::....                                                 
//                                                    .---:::......:::::::::::::........::--==-.                                                 
//                                                      .-=========-=***********+-==========-.                                                   
//                                                        .-=======-*###########*-========-.                                                     
//                                                           :-====-+###########*-====--:                                                        
//                                                               .::+###########*=-:.                                                            
//                                                             .-*%%*###########*%@#+-.                                                          
//                                                          .=#@@@@@@%%%%%%%%%%%@@@@@@@#=.                                                       
//                                                        .*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+.                                                     
//                                                       +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=                                                    
//                                                     .%@@@@@@@@@@%%+-=----=+#%@@@@@@@@@@@@@#.                                                  
//                                                    :@@@@@@@@@@#=::.:....:...::#@@@@@@@@@@@@%.                                                 
//                                                   .%@@@@@@@@@+...:::::........:--*@@@@@@@@@@%                                                 
//                                                   #@@@@@@@@%-...+#########**:..:::%@@@@@@@@@@*                                                
//                                                  :@@@@@@@@@%-..*%%%%%%%%%%%%#:.:.-@@@@@@@@@@@@.                                               
//                                                  +@@@@@@@@@@+ -%%%%%%%%%%%%%%-.. =@@@@@@@@@@@@=                                               
//                                                  *@@@@@@@@@@%.+####%%%%#####%*-..%@@@@@@@@@@@@+                                               
//                                                  +@@@@@@@@@@@-+#*++##%#*++*#%#=.=@@@@@@@@@@@@@=                                               
//                                                  -@@@@@@@@@@@==%#**########%%#-=*%@@@@@@@@@@@@:                                               
//                                                   %@@@@@@@@@@%+%%%%##%##%%%%%#++#@@@@@@@@@@@@#                                                
//                                                   :@@@@@@@@@@@##%%%#######%%%#**@@@@@@@@@@@@@.                                                
//                                                    -@@@@@@@@@@#*%%##########%#=@@@@@@@@@@@@@-                                                 
//                                                     -@@@@@@@@@@*#%#*****#%%%#++#@@@@@@@@@@%:                                                  
//                                                      .#@@@@@@@@@**%%%%%%%%#*+##=-#@@@@@@@*.                                                   
//                                                        -#@@@@%#+:++**##**++*##*#..-+#%@#:                                                     
//                                                          :=-:.. :@+*****##%%##@#.:.....                                                       
//                                                              ...-##*##%%%%#*#%@+ ..                                                           
//                                                                 .=*##+#%%**%*=-.      

/**
 * DAO contract:
 * 1. Collects charity money
 * 2. Allows HODLers to propose a charity and vote
 * 3. Executes successful charity proposals
 * 4. Any token or bnb coin can be exchanged for the DAO Token for using in charity purposes
 * 5. Has no owner
 */

// SPDX-License-Identifier: MIT

pragma solidity ^0.8.10;

interface IBEP20 {
    function approve(address spender, uint256 amount) external returns (bool);
    function balanceOf(address account) external view returns (uint256);
    function transfer(address recipient, uint256 amount) external returns (bool);
}

interface IPancakeswapV2Router01 {
    function WETH() external pure returns (address);
}
 
interface IPancakeswapV2Router02 is IPancakeswapV2Router01 {
    function swapExactETHForTokensSupportingFeeOnTransferTokens(
        uint amountOutMin,
        address[] calldata path,
        address to,
        uint deadline
    ) external payable;
    function swapExactTokensForTokensSupportingFeeOnTransferTokens(
        uint amountIn,
        uint amountOutMin,
        address[] calldata path,
        address to,
        uint deadline
    ) external;
}

contract DAOCharityWallet {

  uint public nextcharityId = 0;
  uint public totalProposalsAmount = 0;
  address public DAOToken;
  IPancakeswapV2Router02 public immutable pancakeswapV2Router;

  struct CharityProposal {
    uint id;
    string name;
    uint amount;
    address payable recipient;
    uint votes;
    uint end;
    bool executed;
  }

  mapping(address => mapping(uint => bool)) public votes;
  mapping(uint => CharityProposal) public charityproposals;
  
  modifier onlyHODLers() {
    require(IBEP20(DAOToken).balanceOf(msg.sender) >= 4200000000000, 'You must HODL at least 4200 DogeMania tokens');
    _;
  }

  constructor(address _Router, address token) {
    DAOToken = token;
    IPancakeswapV2Router02 _pancakeswapV2Router = IPancakeswapV2Router02(_Router);
    pancakeswapV2Router = _pancakeswapV2Router;
  }

  function createCharityProposal(
    string memory name,
    uint amount,
    uint voteTime,
    address payable recipient) 
    public 
    onlyHODLers() {
    require(amount > 0, 'Do not flood');
    require(voteTime >= 3600, 'Minimum vote time is 1 hour');
    CharityProposal memory charity;
    for (uint256 i = 0; i < nextcharityId; i++) {
        charity = charityproposals[i];
        if (charity.executed == false && charity.votes < 420 && charity.amount != 0) {
            totalProposalsAmount = totalProposalsAmount - charity.amount;
            charity.amount = 0;
        }
    }
    require(IBEP20(DAOToken).balanceOf(address(this)) >= totalProposalsAmount + amount, 'Amount too big');
    charityproposals[nextcharityId] = CharityProposal(
      nextcharityId,
      name,
      amount,
      recipient,
      0,
      block.timestamp + voteTime,
      false
    );
    nextcharityId++;
    totalProposalsAmount = totalProposalsAmount + amount;
  }

  function vote(uint charityId) external onlyHODLers() {
    CharityProposal storage charity = charityproposals[charityId];
    require(votes[msg.sender][charityId] == false, 'Each HODLer can only vote once for one charity');
    require(block.timestamp < charity.end, 'CharityProposal end date has passed');
    votes[msg.sender][charityId] = true;
    charity.votes += 1;
  }

  function executeCharity(uint charityId) external {
    CharityProposal storage charity = charityproposals[charityId];
    require(block.timestamp >= charity.end, 'Cannot execute charity before end date');
    require(charity.executed == false, 'Cannot execute charity already executed');
    require(charity.votes >= 420, 'Cannot execute charity with below 420 votes');
    charity.executed = true;
    IBEP20(DAOToken).transfer(charity.recipient, charity.amount);
  }

  function buyDAOTokenForBNB () external {
    require(address(this).balance > 0, "The contract balance must be greater than 0");
    address[] memory path = new address[](2);
    path[0] = pancakeswapV2Router.WETH();
    path[1] = DAOToken;
    uint amount = address(this).balance;
    pancakeswapV2Router.swapExactETHForTokensSupportingFeeOnTransferTokens{value: amount}(
        0,
        path,
        address(this),
        block.timestamp
    );
  }

  function buyDAOTokenForToken (address token) external {
    require(IBEP20(token).balanceOf(address(this)) > 0, "The contract balance must be greater than 0");
    address[] memory path = new address[](3);
    path[0] = token;
    path[1] = pancakeswapV2Router.WETH();
    path[2] = DAOToken;
    IBEP20(token).approve(address(pancakeswapV2Router), IBEP20(token).balanceOf(address(this)));
    pancakeswapV2Router.swapExactTokensForTokensSupportingFeeOnTransferTokens(
        IBEP20(token).balanceOf(address(this)),
        0,
        path,
        address(this),
        block.timestamp
    );
  }

  receive() payable external {
  }
}
